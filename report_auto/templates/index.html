<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>测试报告</title>

    <link rel="stylesheet" type="text/css" href="/static/css/webuploader.css">
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/hashmap.js"></script>
    <script type="text/javascript" src="/static/js/webuploader.min.js"></script>

    <style>
        #picker {
            display: inline-block;
            line-height: 1.428571429;
            vertical-align: middle;
            margin: 0 12px 0 0;
        }
    </style>
</head>
<body>
<div class="container-custom">
    <img src="{{ url_for('static', filename='images/bosch.jpeg') }}" alt="Logo" class="logo-image">

    <div class="content-area">
        <div class="panel panel-primary">
            <div class="panel-footer">

                <div class="col-md-4">
                    <div id="picker">请选择dat文件</div>
                </div>

                <div class="col-md-4">
                    <button type="button" class="btn btn-primary btn-lg mb-3" id="report_generation">生成报告
                    </button>
                </div>

                <div class="col-md-4">
                    <button type="button" class="btn btn-success btn-lg mb-3" id="report_download">下载报告
                    </button>
                </div>
            </div>
        </div>
        <div class="mb-4">
            <textarea class="form-control" id="report_pro_text" rows="15" style="max-height: 300px; overflow-y: auto;"
                      placeholder="双击清屏..."></textarea>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    var fileSuffix;

    /* 构建WebUploader对象，实现文件上传*/
    var uploader = WebUploader
        .create({
            // swf文件路径
            swf: '../static/swf/Uploader.swf',
            // 文件接收服务端。
            server: '{{ url_for("upload") }}',
            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: {
                id: '#picker',//这个id是你要点击上传文件的id
                multiple: true
            },
            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
            resize: true,
            auto: true,
            //开启分片上传
            chunked: true,
            chunkSize: 10 * 1024 * 1024,
            concurrency: 5,
            accept: {
                extensions: "dat",
                mimeTypes: '.dat'
            },
            fileNumLimit: 10
        });

    // 当有文件被添加进队列的时候
    uploader.on('fileQueued', function (file) {
        //保存文件扩展名
        fileSuffix = file.ext;
        fileName = file.source['name'];
        var fileSize = file.size;
        var fileSizeStr = "";
        fileSizeStr = WebUploader.Base.formatSize(fileSize);
        $('#report_pro_text').append(file.name + '( ' + fileSizeStr + ')等待上传..\r\n');
    });

    // 文件上传过程中创建进度条实时显示。
    uploader.on('uploadProgress', function (file, percentage) {
        $('#report_pro_text').append('上传中 ' + Math.round(percentage * 100) + '%\r\n');
    });

    uploader.on('uploadSuccess', function (file) {
        $('#report_pro_text').append(file.name + '上传成功\r\n');
    });

    uploader.on('uploadError', function (file, e) {
        $('#report_pro_text').text(file.name + '上传出错:' + e);
    });

    uploader.on('uploadComplete', function (file) {
        uploader.removeFile(file);
    });
    // 当有文件添加进队列后，开始上传
    uploader.on('all', function (type) {
        if (type === 'startUpload') {
            console.log('开始上传');
        } else if (type === 'uploadSuccess') {
            console.log('上传成功');
        } else if (type === 'uploadFailed') {
            console.log('上传失败');
        }
    });
</script>
<script type="text/javascript" src="/static/js/index.js"></script>
</html>
