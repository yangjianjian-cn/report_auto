<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>Test Report</title>

    <link rel="stylesheet" type="text/css" href="/static/css/webuploader.css">
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/style.css?v=1">
    <link rel="stylesheet" type="text/css" href="/static/css/io_test_uploader.css">
    <link rel="stylesheet" type="text/css" href="/static/layer/theme/default/layer.css">
    <link rel="stylesheet" type="text/css" href="/static/layer/theme/default/layui.css">

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/layer/layer.js"></script>
    <script type="text/javascript" src="/static/layer/layui.js"></script>
    <script type="text/javascript" src="/static/js/webuploader.min.js"></script>
</head>
<body style="height: 100%;">
<div class="container-custom">
    <table class="custom-background">
        <tr>
            <td colspan="3">
                <div class="image-container">
                    <!--  style="width: 40%" -->
                    <img src="{{ url_for('static', filename='images/dev_ops.png') }}" class="image" alt="dev_ops"
                         style="float: right;"/>
                    <!-- style="width: 34%" -->
                    <img src="{{ url_for('static', filename='images/system_software.png') }}" class="image"
                         alt="system_software" style="float: right;">
                </div>
            </td>
        </tr>
    </table>
    <table class="custom-background_table02">
        <tr>
            <td colspan="5" style="text-align: left;">
                <div class="inline-flex">
                    <p class="type-label" style="margin-left: 10px;">
                        <strong> test project:
                            <span style="color: blue; "> {{ test_project_type_name }} </span>
                        </strong>
                    </p>
                    <span>&nbsp;&nbsp;</span>
                    <p id="select1-p" class="type-label" style="margin-right: 10px;"><span
                            style="color: red; ">*</span><strong>test scenario:</strong>
                    </p>
                    <select id="select1" name="inputType" onchange="updateSelectCheck2()"
                            style="margin-right: 10px;width: 200px;">
                        <option value="">--Please select--</option>
                        {% for one_dict_type in tool_dictionary_dict_list %}
                            <option value="{{ one_dict_type.dict_value }}">{{ one_dict_type.dict_name }}</option>
                        {% endfor %}
                    </select>

                    <select id="select2" name="inputType" style="width: 250px;">
                        <option value="" data-label="">--Please select--</option>
                    </select>

                    &nbsp;&nbsp;
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            title="Please check or configure the test template" id="h_test_template">
                        <i class="layui-icon layui-icon-template"></i>
                    </button>

                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"
                            title="one-click upload" id="one_key_upload">
                        <i class="layui-icon layui-icon-upload-circle">FTP</i>
                    </button>
                </div>
            </td>
            <td colspan="5" style="align:right">
                <button type="button" class="layui-btn" id="report_generation">report generation</button>
                <button type="button" class="layui-btn layui-btn-normal" id="report_download">download the report
                </button>
            </td>
        </tr>
        <tr>
            <td colspan="10">
                <input type="hidden" id="test_project_type_id" value="{{ test_project_type_id }}"/>
                <input type="hidden" id="test_project_type_name" value="{{ test_project_type_name }}"/>
                <input type="hidden" id="test_project_type_val" value="{{ test_project_type_val }}"/>
            </td>
        </tr>
    </table>
    <div id="uploader">
        <div class="queueList chart_container ">
            <div id="report_pro_text" class="form-control" style="height: 350px; width:50%; overflow-y: auto;">
                <!-- 文本将被动态添加到这里 -->
            </div>
            <div id="dndArea" class="placeholder" style="height: 350px; width:50%">
                <!--<div id="filePicker"></div>-->
                <div id="customFilePicker"
                     style="width: 100px; height: 40px; background-color: #007bff; color: white; text-align: center; line-height: 40px; cursor: pointer;margin-left:43%;margin-top:2px;margin-bottom:2px;">
                    Select file
                </div>
                <input id="filePicker" type="file" webkitdirectory mozdirectory msdirectory odirectory directory
                       multiple style="display:none;"/>
                <p>Or drag files here to choose up to 50 at a time</p>
            </div>
        </div>
        <div class="statusBar" style="display:none;">
            <div class="progress">
                <span class="text">0%</span>
                <span class="percentage"></span>
            </div>
            <div class="info"></div>
            <div class="btns">
                <div id="filePicker2"></div>
                <div class="uploadBtn">&nbsp;&nbsp;Start uploading&nbsp;&nbsp;</div>
            </div>
        </div>
    </div>
</div>
</body>

<script>
    layui.use(['layer'], function () {
        const layer = layui.layer;
        // 模板配置
        document.getElementById('h_test_template').addEventListener('click', function () {
            const index = layer.open({
                type: 2, // iframe 模式
                title: 'IOTest Test Report Template', // 弹出层标题
                shadeClose: false, // 点击遮罩不关闭弹出层
                shade: 0, // 不显示遮罩
                anim: 5, // 弹出层动画类型
                maxmin: true, // 开启最大化最小化按钮
                area: ['893px', '600px'], // 弹出层大小
                content: '/report/iotest/tplt/page', // iframe 的 URL，包含查询参数
                scrollbar: false, // 显式设置允许显示滚动条
                success: function (layero, index) {
                },
                end: function () {
                }
            });
            layer.full(index);
        });

        document.getElementById('one_key_upload').addEventListener('click', function () {
            layer.prompt(
                {title: 'Enter the file path and confirm it.', formType: 0}
                , function (value, index, elem) {
                    layer.close(index);
                    console.log(value);
                    if (!value) {
                        layer.msg('请输入有效的本地目录路径.', {icon: 5});
                        return;
                    }

                    // 显示加载层
                    const loadingIndex = layer.load(2);

                    fetch('/report/iotest/oneKeyUpload', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({localDirectoryPath: value})
                    })
                        .then(response => response.json())
                        .then(data => {
                            layer.close(loadingIndex);
                            if (data.success) {
                                layer.msg('Upload successful!', {icon: 1});
                            } else {
                                layer.msg('Upload failed: ' + data.message, {icon: 5});
                            }
                        })
                        .catch(error => {
                            layer.close(loadingIndex);
                            layer.msg('An error occurred: ' + error, {icon: 5});
                        });
                }
                , function (index) {
                    layer.close(index);
                    layer.msg('您取消了上传操作.', {icon: 7});
                });
        });

    });
    var uploadedFileName = [];
</script>
<script type="text/javascript" src="/static/js/biz/io_test_uploader.js"></script>
<script type="text/javascript" src="/static/js/selectcheckbox.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<script type="text/javascript" src="/static/js/biz/iotest/oneKeyUpload.js"></script>


<!--
<script type="text/javascript" src="/static/js/echarts.min.js"></script>
<script type="text/javascript" src="/static/js/IOTestPiechart.js?v=1"></script>
-->

</html>